import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = { vus: 1, duration: '5s' };

export default function () {
  const url = 'http://localhost:4000/';
  const payload = JSON.stringify({
    query: `query GetCharacter($id: ID!) {
  getCharacter(id: $id) {
    id
    name
    slug
    totalPower
    image {
      url
      __typename
    }
    powerstats {
      intelligence
      strength
      speed
      durability
      power
      combat
      __typename
    }
    biography {
      fullName
      aliases
      placeOfBirth
      alignment
      publisher
      firstAppearance
      __typename
    }
    appearance {
      gender
      race
      height
      weight
      __typename
    }
    work {
      occupation
      base
      __typename
    }
    __typename
  }
}`,
    operationName: 'GetCharacter',
    variables: {
  "id": "1002"
}
  });
  const headers = { 'Content-Type': 'application/json' };
  const res = http.post(url, payload, { headers });

  check(res, { 'status is 200': (r) => r.status === 200 });

  const json = res.json();
  const r = json;

  // --- Smart assertions generated by OpenAI ---
  const { id, name, slug, totalPower, image, powerstats, biography, appearance, work, __typename } = r.data.getCharacter;
  
  check(r, {
    'id is "1002"': () => id === "1002",
    'name is not empty': () => typeof name === 'string' && name.length > 0,
    'slug is not empty': () => typeof slug === 'string' && slug.length > 0,
    'totalPower is a positive number': () => typeof totalPower === 'number' && totalPower > 0,
    'image url is a valid string': () => image && typeof image.url === 'string' && image.url.length > 0,
    'powerstats all valid positive numbers': () => {
      return ['intelligence','strength','speed','durability','power','combat'].every(stat => {
        const value = Number(powerstats[stat]);
        return !isNaN(value) && value >= 0 && value <= 100;
      });
    },
    'biography fullName is non-empty string': () => typeof biography.fullName === 'string' && biography.fullName.length > 0,
    'appearance gender is Female or Male': () => ['Female', 'Male'].includes(appearance.gender),
    'work occupation is non-empty string': () => typeof work.occupation === 'string' && work.occupation.length > 0,
    '__typename is "Character"': () => __typename === 'Character'
  });

  sleep(1);
}
